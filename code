Get-AzKeyVault | % { $vaultName = $_.VaultName; Get-AzKeyVault -VaultName $vaultName | Select-Object -ExpandProperty AccessPolicies | Select-Object @{Name='VaultName'; Expression={$vaultName}}, @{Name='ObjectId'; Expression={$_.ObjectId}}, @{Name='Keys'; Expression={$_.PermissionsToKeys.Count}}, @{Name='Secrets'; Expression={$_.PermissionsToSecrets.Count}}, @{Name='Certificates'; Expression={$_.PermissionsToCertificates.Count}}, @{Name='DisplayName'; Expression={if ($_.DisplayName -eq "") {"UNKNOWN"} else {$_.DisplayName}}} } | Sort-Object -Property Secrets | Format-Table -AutoSize
